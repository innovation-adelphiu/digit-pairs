<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Digit Pairs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
    body {
      xfont-family: system-ui, sans-serif;
      margin: 20px;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
    }

    .game-container {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    h1 {
      text-align: center;
      margin: 0 0 12px;
      font-size: 1.4rem;
    }

    #rows {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .digit-input,
    .sum-box,
    .operator {
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        height: 4rem;
    }

    .digit-input, .sum-box {
      border-radius: 8px;
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
      font-weight: bold;
      font-size: 2.5rem;
    }

    .digit-input {
      width: 4rem;
      border: 3px dashed #AAA;
      background: #fff;
      color: #666;
      text-shadow:
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px  1px 0 #000,
            1px  1px 0 #000;
    }

    .digit-input:focus {
      outline: none;
      box-shadow: none;
    }

    .sum-box {
        width: 5rem;
        border: 3px solid #444;
        background: #666;
        color: #fff;
        text-shadow:
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px  1px 0 #000,
            1px  1px 0 #000;
    }

    .operator { 
      font-size: 2rem;
      padding: 4px;
      font-weight: bold;
      font-family: system-ui, sans-serif;
      line-height: 4rem;
    }

    .digit-valid   { border: 4px solid  #080 !important; }
    .digit-invalid { border: 4px dashed #B00 !important; }
    .focus-correct { border: 6px double #080 !important; }
    .focus-neutral { border: 6px double #AAA !important; }
    
</style>

</head>
<body>
  <div class="game-container">
    <h1>Digit Pairs</h1>
    <div id="rowsContainer"></div>
  </div>

<script>
   
const sumValues = [5, 7, 10, 11, 12];
const rowsContainer = document.getElementById("rowsContainer");

for (let i = 0; i < sumValues.length; i++)
{
    let sumValue = sumValues[i];

    const row = document.createElement("div");
    row.className = "row";

    const digitLeft = document.createElement("input");
    digitLeft.type = "text";
    digitLeft.className = "digit-input";
    digitLeft.setAttribute("inputmode", "numeric");

    const plusDiv = document.createElement("div");
    plusDiv.className = "operator";
    plusDiv.textContent = "+";

    const digitRight = document.createElement("input");
    digitRight.type = "text";
    digitRight.className = "digit-input";
    digitRight.setAttribute("inputmode", "numeric");

    const equalsDiv = document.createElement("div");
    equalsDiv.className = "operator";
    equalsDiv.textContent = "=";

    const sumBox = document.createElement("div");
    sumBox.className = "sum-box";
    sumBox.textContent = String(sumValue);

    row.appendChild(digitLeft);
    row.appendChild(plusDiv);
    row.appendChild(digitRight);
    row.appendChild(equalsDiv);
    row.appendChild(sumBox);

    rowsContainer.appendChild(row);
}

const digitInputs = document.querySelectorAll(".digit-input");

for (let i = 0; i < digitInputs.length; i++)
{
    let input = digitInputs[i];

    input.addEventListener("keydown", (event) => 
    {
        const key = event.key;

        // let browser handle these navigation keys 
        if (key === "Tab" || key === "Home" || key === "End")   
            return;

        // block other keys
        event.preventDefault();

        if (key >= "0" && key <= "9") // overwrite digits
        {
            input.value = key;
            updateGameState();
        }
        else if (key === "Backspace" || key === "Delete" || key === " ") // clear
        {
            input.value = "";
            updateGameState();
        }        
        else if (key === "ArrowLeft" || key === "ArrowRight" || key === "ArrowUp" || key === "ArrowDown") // navigation
        {
            let targetIndex = null;

            if (key === "ArrowLeft" && i > 0)
                targetIndex = i - 1;
            else if (key === "ArrowRight" && i < digitInputs.length - 1)
                targetIndex = i + 1;
            else if (key === "ArrowUp" && i - 2 >= 0)
                targetIndex = i - 2; // same column, previous row
            else if (key === "ArrowDown" && i + 2 < digitInputs.length)
                targetIndex = i + 2; // same column, next row

            if (targetIndex !== null)
                digitInputs[targetIndex].focus();
        }
    });

    input.addEventListener("focus", updateGameState);
    input.addEventListener("blur", updateGameState);
}

// -------------------------------

const rows = Array.from(document.querySelectorAll(".row"));
const sumBoxes = Array.from(document.querySelectorAll(".sum-box"));

function updateGameState() 
{
    // clear current status border styles
    for (let i = 0; i < digitInputs.length; i++)
        digitInputs[i].classList.remove("digit-valid", "digit-invalid", "focus-correct", "focus-neutral");

    for (let i = 0; i < sumBoxes.length; i++)
        sumBoxes[i].classList.remove("digit-valid", "digit-invalid", "focus-correct", "focus-neutral");

    // check if row sum is correct
    for (let i = 0; i < rows.length; i++) // 5 rows
    {
        row = rows[i];
        // get elements from this row
        let [digitLeft, digitRight] = row.querySelectorAll(".digit-input");
        let sumBox = row.querySelector(".sum-box");
        
        let valueLeft = digitLeft.value;
        let valueRight = digitRight.value;

        // if either box is empty, continue on to check next row
        if (valueLeft == "" || valueRight == "")
            continue; 
        // convert strings to numbers
        valueLeft = parseInt(valueLeft, 10);
        valueRight = parseInt(valueRight, 10);

        if (valueLeft + valueRight == sumValues[i]) 
        {
            digitLeft.classList.add("digit-valid");
            digitRight.classList.add("digit-valid");
            sumBox.classList.add("digit-valid");
        } 
        else 
        {
            digitLeft.classList.add("digit-invalid");
            digitRight.classList.add("digit-invalid");
        }
    }

    // invalid overrides valid

    // count number of times each digit occurs
    let digitCounts = Array(10).fill(0);
    for (let i = 0; i < digitInputs.length; i++)
    {
        let input = digitInputs[i];
        if (input.value !== "")
            digitCounts[input.value] += 1;        
    }

    // mark non-empty duplicates as incorrect
    for (let i = 0; i < digitInputs.length; i++)
    {
        let input = digitInputs[i];
        let v = input.value;
        if (v !== "" && digitCounts[v] > 1)
        {
            input.classList.add("digit-invalid");
            input.classList.remove("digit-valid");
        }
    }

    // if any inputs have focus, update border style
    for (let i = 0; i < digitInputs.length; i++)
    {
        let input = digitInputs[i];
        if (document.activeElement === input) 
        {
            if ( input.classList.contains("digit-valid") )
                input.classList.add("focus-correct");
            else
                input.classList.add("focus-neutral");
        }
    }
}
    
</script>
</body>
</html>
